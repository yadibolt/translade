(()=>{"use strict";const t={modulePrefix:"<Translade>:",sessionName:"translade-settings",assetsFolder:"/modules/translade",localesFolder:"/modules/translade/locales",selectedLangIdDefault:"default",maximumHistoryLength:50,specialToken:"|TRSLD_SPT|",baseUrl:"/api/translade",translationEndpoint:"/translate",rephraseEndpoint:"/rephrase",checkGrammarEndpoint:"/check-grammar",summarizeEndpoint:"/summarize",expandContentEndpoint:"/expand-content",shortenContentEndpoint:"/shorten-content",changeToneProfessionalEndpoint:"/change-tone-professional",changeToneCasualEndpoint:"/change-tone-casual",simplifyContentEndpoint:"/simplify-content"};class e{constructor(){}throwException(e,n=null,a=null,s=!1){return s||console.error(`${t.modulePrefix} ${e}\nErr: ${n}\nCode: ${a||"N/A"}`),!1}}const n=!0,a=t=>document.getElementById(t)||(new e).throwException(`Element with ID "${t}" not found.`,null,null,n),s=(t,a=null)=>{if(null!==a){const s=a.getElementsByClassName(t);return s&&0!==s.length?s:(new e).throwException(`No elements found with class "${t}".`,null,null,n)}{const a=document.getElementsByClassName(t);return a&&0!==a.length?a:(new e).throwException(`No elements found with class "${t}".`,null,null,n)}},i=t=>document.getElementsByClassName(t)[0]||(new e).throwException(`First element with class "${t}" not found.`,null,null,n),r=(t,a=null)=>{if(null!==a){return a.querySelectorAll(t)[0]||(new e).throwException(`Element with selector "${t}" not found in the provided root.`,null,null,n)}return document.querySelectorAll(t)[0]||(new e).throwException(`Element with selector "${t}" not found.`,null,null,n)},o=(t,a=null)=>{if(null!==a){return a.querySelectorAll(t)||(new e).throwException(`Element with selector "${t}" not found in the provided root.`,null,null,n)}return document.querySelectorAll(t)||(new e).throwException(`Element with selector "${t}" not found.`,null,null,n)},l=(t=[],e=[],n)=>{t.forEach((t,e)=>{t.classList&&t.classList.contains(n)&&t.classList.remove(n)}),e.forEach((t,e)=>{t.classList&&!t.classList.contains(n)&&t.classList.add(n)})};class c{constructor(){}initConfiguration(t){const n=a("translade-shadow-root-config"),s=String(n.value);if(s.length<=0)return(new e).throwException("Configuration is empty.",null,null);try{const t=JSON.parse(s.trim());if("object"!=typeof t)return(new e).throwException("Parsed configuration is not an object.",null,null);n.remove();let a=[];return Array.isArray(t.content_ai_actions)&&(a=t.content_ai_actions),{languages:String(t.languages).trim().split(","),contentLanguage:String(t.content_language).trim(),darkTheme:Boolean(t.dark_theme),contentAIActions:a,formId:String(t.form_id),renderMode:String(t.render_mode).trim(),translationSet:null,history:{}}}catch(t){return(new e).throwException("Tried to parse invalid JSON configuration.",t,null)}}}const d={selectedLangId:t.selectedLangIdDefault};class g{sessionIdentifier=null;constructor(){this.sessionIdentifier=t.sessionName}initSession(){return window.sessionStorage.getItem(this.sessionIdentifier)||(window.sessionStorage.setItem(this.sessionIdentifier,JSON.stringify(this._getSessionSettingsDefault())),window.sessionStorage.getItem(this.sessionIdentifier))}getSession(){const t=window.sessionStorage.getItem(this.sessionIdentifier);if(!t)return this.initSession();try{return JSON.parse(t)}catch(t){return(new e).throwException("Tried to parse invalid JSON.",t,null)}}updateData(n){if(!this.getSession())return(new e).throwException("Session does not exits",null,null);if("object"!=typeof n)return(new e).throwException("Passed data must be an object.",null,null);try{let e=this.getSession(),a=JSON.stringify({...e,...n});window.sessionStorage.setItem(t.sessionName,a)}catch(t){return(new e).throwException("Tried to update session with invalid data.",t,null)}}clearSession(){this.updateData({})}destroySession(){window.sessionStorage.removeItem(this.sessionIdentifier)}_getSessionSettingsDefault(){return d}}class u{constructor(){}getShadowRootFields(){const t=document.querySelectorAll('div[id*="translade-shadow-root-"]');return!t||t.length<=0?(new e).throwException("Could not find fields.",null,null):t}getTranslationTableFields(){const t=r("#edit-strings tbody");if(!t)return;const e=Array.from(t.childNodes).filter(t=>"TR"===t.nodeName);return e.length>0?e:null}}class h{id=null;classNames=null;dataset={};content=null;constructor(...t){const{id:e=null,dataset:n={},classNames:a=null,content:s=null}=t[0]||{};this.id=e,this.classNames=a,this.content=s,this.dataset=n}getDefault(){let t=document.createElement("div");if(this.id&&(t.id=this.id),this.classNames&&t.classList.add(...this.classNames),this.content&&(t.innerHTML=this.content),this.dataset)for(const[e,n]of Object.entries(this.dataset))t.dataset[e]=n;return t}}class m{id=null;classNames=null;src=null;alt=null;constructor(...t){const{id:e=null,classNames:n=null,src:a=null,alt:s=null}=t[0]||{};this.id=e,this.classNames=n,this.src=a,this.alt=s}getDefault(){let t=document.createElement("img");return this.id&&(t.id=this.id),this.classNames&&t.classList.add(...this.classNames),this.src&&(t.src=this.src),this.alt&&(t.alt=this.alt),t}}class f{id=null;classNames=null;content=null;constructor(...t){const{id:e=null,classNames:n=null,content:a=null}=t[0]||{};this.id=e,this.classNames=n,this.content=a}getDefault(){let t=document.createElement("span");return this.id&&(t.id=this.id),this.classNames&&t.classList.add(...this.classNames),this.content&&(t.innerHTML=this.content),t}}class w{id=null;classNames=null;href=null;title=null;dataset=null;content=null;constructor(...t){const{id:e=null,classNames:n=null,href:a=null,title:s=null,dataset:i=null,content:r=null}=t[0]||{};this.id=e,this.classNames=n,this.href=a,this.title=s,this.dataset=i,this.content=r}getDefault(){let t=document.createElement("a");if(this.id&&(t.id=this.id),this.classNames&&t.classList.add(...this.classNames),this.href&&(t.href=this.href),this.title&&(t.title=this.title),this.dataset)for(const[e,n]of Object.entries(this.dataset))t.dataset[e]=n;return this.content&&(t.innerHTML=this.content),t}}class p{name=null;value=null;isSelected=!1;constructor(...t){const{name:e=null,value:n=null,isSelected:a=!1}=t[0]||{};this.name=e,this.value=n,this.isSelected=a}getDefault(){const t=document.createElement("option");return this.value&&t.setAttribute("value",this.value),this.name&&(t.innerHTML=this.name),this.isSelected&&t.setAttribute("selected","selected"),t}}class S{id=null;classNames=[];name=null;options=[];constructor(...t){const{id:e=null,classNames:n=[],name:a=null,options:s=[]}=t[0]||{};this.id=e,this.classNames=n,this.name=a,this.options=s}getDefault(){const t=document.createElement("select");return this.id&&(t.id=this.id),this.classNames.length>0&&t.classList.add(...this.classNames),this.name&&(t.name=this.name),this.options.length>0&&this.options.forEach(n=>{if(!n)return(new e).throwException("Invalid OptionTag element provided.",null,null);t.appendChild(n)}),t}}class _{id=null;classNames=null;dataset={};content=null;constructor(...t){const{id:e=null,dataset:n={},classNames:a=null,content:s=null}=t[0]||{};this.id=e,this.classNames=a,this.content=s,this.dataset=n}getDefault(){let t=document.createElement("label");if(this.id&&(t.id=this.id),this.classNames&&t.classList.add(...this.classNames),this.content&&(t.innerHTML=this.content),this.dataset)for(const[e,n]of Object.entries(this.dataset))t.dataset[e]=n;return t}}class y{constructor(){}async setTranslationSet(e){let n=await fetch(`${t.localesFolder}/${e}.json`);if(n.ok)window.transladeConfig.translationSet=await n.json();else{let e=await fetch(`${t.localesFolder}/en.json`);window.transladeConfig.translationSet=await e.json()}}getTranslationSet(){return window.transladeConfig.translationSet}}class T{tSet=null;constructor(){this.tSet=(new y).getTranslationSet()}createActionsForField(e){const n=window.transladeConfig.darkTheme?"dark":"light";let a=[],s=[];window.transladeConfig.languages.forEach((t,e)=>{const n=t.split(":"),s=n[0]===(new g).getSession().selectedLangId;a.push(new p({name:n[1],value:n[0],isSelected:s}).getDefault())}),s.push(new p({name:this.tSet.actionName,value:"default"}).getDefault()),window.transladeConfig.contentAIActions.forEach((t,e)=>{const n=t.split(":");let a=n[0];Object.keys(this.tSet).some(t=>t.toString()===n[0].toString())&&(a=this.tSet[n[0]]),s.push(new p({name:a,value:n[0]}).getDefault())});const i=new h({classNames:["translade-actions-wrapper",n]}).getDefault(),r=new m({src:`${t.assetsFolder}/icons/back.svg`,alt:this.tSet.back}).getDefault(),o=new m({src:`${t.assetsFolder}/icons/translate.svg`,alt:this.tSet.translate}).getDefault(),l=new S({classNames:["translade-languageTo"],name:"translade-languageTo",options:a}).getDefault(),c=new S({classNames:["translade-contentAIAction"],name:"translade-contentAIAction",options:s}).getDefault(),d=new f({classNames:["loader"]}).getDefault(),u=new _({content:this.tSet.languageTranslateTo,classNames:["translade-label"]}).getDefault(),y=new _({content:this.tSet.chooseAction,classNames:["translade-label"]}).getDefault(),T=new w({classNames:["translade-action-trigger","back"],title:this.tSet.backToPreviousText,dataset:{targetField:e}}).getDefault();T.appendChild(r);const x=new w({classNames:["translade-action-trigger","translate"],title:this.tSet.translateText,dataset:{targetField:e}}).getDefault();x.appendChild(o);const v=new h({classNames:["translade-action-trigger","language-select"],dataset:{targetField:e}}).getDefault();v.appendChild(u),v.appendChild(l);const b=new h({classNames:["translade-action-trigger","content-ai-action-select"],dataset:{targetField:e}}).getDefault();b.appendChild(y),b.appendChild(c);const L=new w({classNames:["translade-action-trigger","load","action-hide"],title:this.tSet.loading,dataset:{targetField:e}}).getDefault();return L.appendChild(d),[T,x,v,b,L].forEach((t,e)=>{i.appendChild(t)}),i}createActionsForTranslationTableField(e){const n=window.transladeConfig.darkTheme?"dark":"light",a=new h({classNames:["translade-actions-wrapper",n]}).getDefault(),s=new m({src:`${t.assetsFolder}/icons/back.svg`,alt:this.tSet.back}).getDefault(),i=new m({src:`${t.assetsFolder}/icons/translate.svg`,alt:this.tSet.translate}).getDefault(),r=new f({classNames:["loader"]}).getDefault(),o=new w({classNames:["translade-action-trigger","back"],title:this.tSet.backToPreviousText,dataset:{targetField:e}}).getDefault();o.appendChild(s);const l=new w({classNames:["translade-action-trigger","translate"],title:this.tSet.translateText,dataset:{targetField:e}}).getDefault();l.appendChild(i);const c=new w({classNames:["translade-action-trigger","load","action-hide"],title:this.tSet.loading,dataset:{targetField:e}}).getDefault();return c.appendChild(r),[o,l,c].forEach((t,e)=>{a.appendChild(t)}),a}}class x{constructor(){}getStringTypeValue=t=>{const e=r("input",t);return String(e.value)};getStringTypeElement=t=>r("input",t);getStringLongTypeValue=t=>{const e=r("textarea",t);return String(e.value)};getStringLongTypeElement=t=>r("textarea",t);getStringTextareaTypeValue=t=>String(t.value);getStringTextareaTypeElement=t=>a(t.id);getTextWithSummaryValue=e=>{let n=o(".form-textarea-wrapper",e),a=null,s=null;if(1===n.length?s=n[0]:(a=n[0],s=n[1]),o("div.ck",s).length>0){const e=r(".ck .ck.ck-content",s);return(null!==a?r("textarea",a):"").value+`${t.specialToken}`+e.innerHTML}{const e=r("textarea",s);return(null!==a?r("textarea",a):"").value+`${t.specialToken}`+e.value}};getTextWithSummaryElement=t=>{let e=o(".form-textarea-wrapper",t),n=null,a=null;return 1===e.length?a=e[0]:(n=e[0],a=e[1]),{summary:r("textarea",n),text:r("textarea",a)}};getTextLongValue=t=>{let e=s(".form-textarea-wrapper",t)[0];return o("div.ck",e).length>0?r(".ck .ck.ck-content",e).innerHTML:r("textarea",e).value};getTextLongElement=t=>{let e=s(".form-textarea-wrapper",t)[0];return r("textarea",e)};setStringTypeValue=(t,e)=>{r("input",t).value=String(e)};setStringLongTypeValue=(t,e)=>{r("textarea",t).value=String(e)};setStringTextareaTypeValue=(t,e)=>{t.value=String(e)};setTextWithSummaryValue=(e,n)=>{let a=o(".form-textarea-wrapper",e),s=null,i=null;if(1===a.length?s=a[0]:(i=a[0],s=a[1]),o("div.ck",s).length>0){const e=i?r("textarea",i):"";let o=n.split(`${t.specialToken}`);const l=r(".ck-editor__editable",s).ckeditorInstance;1===a.length||(e.value=String(o[0])),l&&l.setData(String(o[1]))}else{const e=r("textarea",s),a=i?r("textarea",i):null;let o=n.split(`${t.specialToken}`);null===a||(a.value=String(o[0])),e.value=String(o[1])}};setTextLongValue=(t,e)=>{let n=s(".form-textarea-wrapper",t)[0];if(o("div.ck",n).length>0){const t=r(".ck-editor__editable",n).ckeditorInstance;t&&t.setData(String(e))}else r("textarea",n).value=String(e)};setFieldData=(t,e)=>{const n=window.transladeConfig.renderMode,s="translation_table"===n?a(t):i(t);if(!s)return;const r="translation_table"===n?"string_textarea":Array.from(s.classList).find(t=>t.startsWith("translade-type-"));if(r)switch(String(r).replaceAll("translade-type-","")){case"string_textarea":this.setStringTextareaTypeValue(s,e);break;case"string":case"text":this.setStringTypeValue(s,e);break;case"string_long":this.setStringLongTypeValue(s,e);break;case"text_long":this.setTextLongValue(s,e);break;case"text_with_summary":this.setTextWithSummaryValue(s,e)}}}class v{constructor(){}setHistoryData=e=>{const n=new x,s=window.transladeConfig.renderMode;let r=window.transladeConfig.history;const o="translation_table"===s?a(e):i(e);if(!o)return;const l="translation_table"===s?"string_textarea":Array.from(o.classList).find(t=>t.startsWith("translade-type-"));if(!l)return;let c="";switch(String(l).replaceAll("translade-type-","")){case"string_textarea":c=n.getStringTextareaTypeValue(o);break;case"string":case"text":c=n.getStringTypeValue(o);break;case"string_long":c=n.getStringLongTypeValue(o);break;case"text_long":c=n.getTextLongValue(o);break;case"text_with_summary":c=n.getTextWithSummaryValue(o)}r[e]&&void 0!==r[e]?(r[e.toString()].length>=t.maximumHistoryLength&&r[e.toString()].shift(),r[e.toString()].push(c)):r[e.toString()]=[c],window.transladeConfig.history=r};getLastHistoryRecord=t=>{let e=window.transladeConfig.history;return e&&e[t]&&void 0!==e[t]?e[t][e[t].length-1]:null};restoreFromHistory=t=>{const e=new x;let n=window.transladeConfig.history;n&&n[t]&&void 0!==n[t]&&(n[t].length>1&&n[t].pop(),n[t][n[t].length-1]&&(window.transladeConfig.history=n,e.setFieldData(t,n[t][n[t].length-1])))}}class b{constructor(){}renderActionsForFields(){const t=new T,e=new v;(new u).getShadowRootFields().forEach((n,a)=>{const s=n.id.replaceAll("translade-shadow-root-","translade-field-");if(i(s)){const a=t.createActionsForField(s);n.appendChild(a),e.setHistoryData(s)}})}renderActionsForTranslationTableFields(){const t=new T,e=new v;(new u).getTranslationTableFields().forEach((n,a)=>{const s=r(".form-textarea-wrapper",o("td",n)[1]),i=r(".form-textarea-wrapper textarea",o("td",n)[1]),l=i.id;if(i){const n=t.createActionsForTranslationTableField(l);s.appendChild(n),e.setHistoryData(l)}})}}class L{constructor(){}translate(e,n){const a=window.transladeConfig,s=new x,i=new v,o=(new g).getSession(),c=i.getLastHistoryRecord(e);let d=r("a.back",n),u=r("a.translate",n),h=r("a.load",n),m=r("div.language-select",n);const f=r("div.content-ai-action-select",n),w={form_id:String(a.formId),text:String(c),trigger_id:String(e),source_lang:String(a.contentLanguage),target_lang:String(o.selectedLangId)};return l([h],[d,u,m,f],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.translationEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.target_lang&&t.status&&t.translated_text&&t.trigger_id||(l([d,u,m,f],[h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.translated_text),i.setHistoryData(e),l([d,u,m,f],[h],"action-hide"),n(t)}).catch(t=>{l([d,u,m,f],[h],"action-hide"),a(t)})})}translateTableField(e,n){const s=window.transladeConfig,i=new x,o=new v,c=(new g).getSession();let d=a(`edit-strings-${e.split("-")[2]}-original`);if(!d)return;const u=d.value,h=d.parentNode.lang;console.log(h);let m=r("a.back",n),f=r("a.translate",n),w=r("a.load",n);const p={form_id:String(s.formId),text:String(u),trigger_id:String(e),source_lang:String(s.contentLanguage),target_lang:String(c.selectedLangId)};return l([w],[m,f],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.translationEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.target_lang&&t.status&&t.translated_text&&t.trigger_id||(l([m,f],[w],"action-hide"),a("Returned data do not follow the structure.")),i.setFieldData(t.trigger_id,t.translated_text),o.setHistoryData(e),l([m,f],[w],"action-hide"),n(t)}).catch(t=>{l([m,f],[w],"action-hide"),a(t)})})}rephrase(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.rephraseEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.rephrased_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.rephrased_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}checkGrammar(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.checkGrammarEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.checked_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.checked_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}summarize(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.summarizeEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.summarized_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.summarized_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}expandContent(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.expandContentEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.expanded_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.expanded_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}shortenContent(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.shortenContentEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.shortened_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.shortened_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}changeToneProfessional(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.changeToneProfessionalEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.changed_tone_professsional_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.changed_tone_professsional_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}changeToneCasual(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.changeToneCasualEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.changed_tone_casual_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.changed_tone_casual_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}simplifyContent(e,n){const a=window.transladeConfig,s=new x,i=new v,o=i.getLastHistoryRecord(e);let c=r("a.back",n),d=r("a.translate",n),g=r("a.load",n),u=r("div.language-select",n);const h=r("div.content-ai-action-select",n),m={form_id:String(a.formId),text:String(o),trigger_id:String(e),source_lang:String(a.contentLanguage)};return l([g],[c,d,u,h],"action-hide"),new Promise((n,a)=>{fetch(`${t.baseUrl}${t.simplifyContentEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(t=>t.json()).then(t=>{t.form_id&&t.source_lang&&t.status&&t.simplified_text&&t.trigger_id||(l([g],[c,d,u,h],"action-hide"),a("Returned data do not follow the structure.")),s.setFieldData(t.trigger_id,t.simplified_text),i.setHistoryData(e),l([c,d,u,h],[g],"action-hide"),n(t)}).catch(t=>{l([c,d,u,h],[g],"action-hide"),a(t)})})}}class E{inputWritesDelay=null;inputWrites=null;constructor(){this.inputWritesDelay=500,this.inputWrites={inputFields:null}}addEventListeners(){this._evLisBackAction(),this._evLisTranslateAction(),this._evListLanguageChange(),this._evLisAIActions(),this._evLisInputChanged()}addEventListenersForTranslationTable(){this._evLisBackActionTable(),this._evLisTranslateActionTable()}_evLisBackAction(){(new u).getShadowRootFields().forEach((t,e)=>{const n=r("a.back",t);if(!n)return;const a=t.id.replaceAll("translade-shadow-root-","translade-field-");n.addEventListener("click",t=>{t.preventDefault(),(new v).restoreFromHistory(a)})})}_evLisBackActionTable(){(new u).getTranslationTableFields().forEach((t,e)=>{const n=r(".form-textarea-wrapper",o("td",t)[1]),a=r(".form-textarea-wrapper textarea",o("td",t)[1]).id,s=r("a.back",n);s&&s.addEventListener("click",t=>{t.preventDefault(),(new v).restoreFromHistory(a)})})}_evLisTranslateAction(){(new u).getShadowRootFields().forEach((t,e)=>{const n=r("a.translate",t);if(!n)return;const a=t.id.replaceAll("translade-shadow-root-","translade-field-");n.addEventListener("click",e=>{e.preventDefault(),(new L).translate(a,t)})})}_evLisTranslateActionTable(){(new u).getTranslationTableFields().forEach((t,e)=>{const n=r(".form-textarea-wrapper",o("td",t)[1]),a=r(".form-textarea-wrapper textarea",o("td",t)[1]).id,s=r("a.translate",n);s&&s.addEventListener("click",t=>{t.preventDefault(),(new L).translateTableField(a,n)})})}_evLisAIActions(){(new u).getShadowRootFields().forEach((t,e)=>{const n=r("div.content-ai-action-select select",t);if(!n)return;const a=t.id.replaceAll("translade-shadow-root-","translade-field-");n.value="default",n.addEventListener("change",e=>{switch(e.preventDefault(),String(e.target.value)){case"rewriteRephrase":(new L).rephrase(a,t);break;case"checkGrammar":(new L).checkGrammar(a,t);break;case"summarize":(new L).summarize(a,t);break;case"expansionElaboration":(new L).expandContent(a,t);break;case"shortenCondense":(new L).shortenContent(a,t);break;case"changeToneProfessional":(new L).changeToneProfessional(a,t);break;case"changeToneCasual":(new L).changeToneCasual(a,t);break;case"simplify":(new L).simplifyContent(a,t);break;case"default":return}n.value="default"})})}_evListLanguageChange(){(new u).getShadowRootFields().forEach((e,n)=>{const a=r("div.language-select select",e);if(!a)return;const i=new g;i.getSession().selectedLangId.toString()===t.selectedLangIdDefault.toString()&&i.updateData({selectedLangId:a.value.toString()}),a.addEventListener("change",t=>{t.preventDefault(),i.updateData({selectedLangId:t.target.value.toString()});const e=s("translade-languageTo",document);for(const n of e)n.value=t.target.value.toString()})})}_evLisInputChanged(){const t=new x;(new u).getShadowRootFields().forEach((e,n)=>{const a=e.id.replaceAll("translade-shadow-root-","translade-field-"),s=i(a),o=Array.from(s.classList).find(t=>t.startsWith("translade-type-"));if(!o)return;let l=null;switch(String(o).replaceAll("translade-type-","")){case"string":case"text":l=t.getStringTypeElement(s);break;case"string_long":l=t.getStringLongTypeElement(s);break;case"text_long":l=t.getTextLongElement(s);break;case"text_with_summary":l=t.getTextWithSummaryElement(s)}if(l){let t=!1;if(l.summary&&(this._setInputWrites(a,l.summary),t=!0),l.text){const e=r("div.ck.ck-content",l.text.parentElement);e&&this._setInputWrites(a,e),t=!0}t||this._setInputWrites(a,l)}})}_setInputWrites(t,e){e.addEventListener("keyup",e=>{clearTimeout(this.inputWrites.inputFields),this.inputWrites.inputFields=setTimeout(()=>{(new v).setHistoryData(t)},this.inputWritesDelay)})}}!function(t,e){t.behaviors.translade={attach:function(t,a){e("translade","body",t).forEach(async function(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):await n()})}};const n=async()=>{switch(window.transladeConfig=(new c).initConfiguration(),(new g).initSession(),await(new y).setTranslationSet(window.transladeConfig.contentLanguage.toString()),window.transladeConfig.renderMode){case"node_edit":case"node_create":case"taxonomy":(new b).renderActionsForFields(),(new E).addEventListeners();break;case"translation_table":(new b).renderActionsForTranslationTableFields(),(new E).addEventListenersForTranslationTable()}}}(Drupal,once)})();